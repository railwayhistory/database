path: base/sections
content:
    en:
        title: Sections Format
        body: |
            This page describes the format through which the
            geographical shape of a section is defined and how this is
            turned into maps.


            Section Data
            ------------

            The geographical course of a section is given either by a
            textual or structured form. The textual form is the canonical
            form and the structured form is derived from it. Its sole
            purpose is to make rendering easier.
            
            The textual form follows a very simple language. The
            description consists of simple words that are separated by
            white space (ie., space characters, tabs, or line breaks).
            The first character of each word determines the group the
            word belongs to:

            * If the first character is a digit, ie., the characters `0`
              to `9`, or a hyphen `-`, the word contains a geographical
              coordinate defining a point on the section. It starts with
              the latitude followed by a comma `,` and the longitude  with
              no space in between. Both values are given in degrees with
              decimal fractions delimited by a period '.'. Southern
              latitudes and western longitudes are given as negative
              values starting with a hyphen `-`.

            * If the first character is a opening parenthesis, everything
              until the closing parenthesis is interpreted as a geographical
              coordinate defining a point in the form as above except that
              white space is allowed before and after the values.

            * If the first character is a latin letter, ie., any of the
              characters from `a` to `z` or `A` to `Z`, the word defines a
              point on the section through a function. The full word
              starts with the function name, followed by an opening
              parenthesis, a list of arguments separated by commas, and a
              closing parenthesis. See below for known functions.

            * If the first character is an equals sign `=`, the rest of the
              words defines a name for the previous point. The name can be
              used by the `ref()` function to reference the point from
              another section.

            * If the word starts with a tilde `~`, the rest of word contains
              a radius in meters. The previous and next point on the line
              shall be connected through a circular arc with the given
              radius.

            * If the word consists of two periods, ie., `..`, the previous
              and next point should be connected by a smooth curve. This is
              a temporary device to approximate the course if the radius
              for circular arcs is not known.


            Functions
            ---------

            Functions are used to calculate the position of a point and
            the direction of the curve. Since they usually refer to points
            on other sections, they actually result in a point and two
            possible directions, namely following the referenced section
            from start to end or going the other way from end to start. If
            a choice is necessary, the renderer will have to take the
            direction that leads to the shorter segment.

            The following functions are currently understood:

            * `start(id)`: References the starting point of the section
              given by `id`.

            * `end(id)`: References the end point of the section given by
              `id`.

            * `ref(id, name)`: References a named point of the section given
               by `id`, ie., the point followed by `=name`.


            Rendering Sections
            ------------------

            The result of processing the section data is a list of points
            and rules for connecting them. These rules are:

            * circular arc with a given radius,
            * smooth curve,
            * straight line (the default if nothing else is given).

            In its ultimate form, a section should be continuous in the
            sense that there should be no sudden changes in direction. This
            happens if two straight lines of different direction are
            connected. This will be accepted for now, since most of the
            source data we work with only supports straight lines. However,
            the circular arc and the smooth curve are to be calculated in
            such a way that the section will be continuous. For a circular
            arc, this means that it will be placed in such a way that it
            forms a tangent at the previous point and passes through the
            next point. If the next segment of the section is a straight
            line, it should be a tangent of the arc as well. A smooth
            line connects two points in such a way, that a continuous
            connection is being formed at both ends. How this is being done
            is left to the renderer.

            _Note:_ Currently, only straight rendering is implemented. All
            curve instructions are ignored and replaced by a straight line.
            Which probably looks horrible ...

